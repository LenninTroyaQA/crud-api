version: 2.1

jobs:
  Tests:
    docker:
      - image: lennint/python-browsers-brew:latest
    working_directory: ~/repo
    steps:
      - checkout
      - run:
          name: "Install requirements and run tests"
          command: |
            npm install
            npm start &
            sleep 10
            git submodule update --init  # Initialize and update existing submodule
            cd tests-api
            pip install -r requirements.txt
            pytest --alluredir=allure-results
            sleep 10
            ls allure-results
            allure generate allure-results -o allure-report
      - store_artifacts:
          path: tests-api/allure-report

workflows:
  Testing:
    jobs:
      - Tests:
          filters:
            branches:
              only: /^release-.*$/
