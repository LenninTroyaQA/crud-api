version: 2.1

jobs:
  Build and Test:
    docker:
      - image: lennint/python-browsers-brew:latest

    working_directory: ~/repo
    steps:
      - checkout
      - run:
          name: "Install requirements and run tests"
          command: |
            npm install
            npm start &
            git submodule add https://github.com/LenninTroyaQA/tests-api
            cd tests-api
            pytest --alluredir=allure-results || true
            allure generate allure-results -o allure-report

      - store_artifacts:
          path: tests-api/allure-report

workflows:
  Build and Test:
    jobs:
      - Build and Test:
          filters:
            branches:
              only: /^release-.*$/
